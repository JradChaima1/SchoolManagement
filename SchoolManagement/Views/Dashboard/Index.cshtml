@model School.Core.Interfaces.DashboardStatistics
@{
    ViewData["Title"] = "Analytics Dashboard";
}

<link rel="stylesheet" href="https://cdn3.devexpress.com/jslib/20.1.3/css/dx.light.css" />

<div class="dashboard-container">
  
    <div class="row ">
        <div class="col-md-2">
            <div class="stat-card bg-primary">
                <div class="stat-icon">
                    <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-content">
                    <h3>@Model.TotalStudents</h3>
                    <p>Total Students</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-card bg-success">
                <div class="stat-icon">
                    <i class="bi bi-person-badge-fill"></i>
                </div>
                <div class="stat-content">
                    <h3>@Model.TotalTeachers</h3>
                    <p>Total Teachers</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-card bg-info">
                <div class="stat-icon">
                    <i class="bi bi-door-open-fill"></i>
                </div>
                <div class="stat-content">
                    <h3>@Model.TotalClassrooms</h3>
                    <p>Total Classrooms</p>
                </div>
            </div>
        </div>
       
    </div>

    <div class="row">
        <div class="col-md-2">
            <div class="stat-card bg-secondary">
                <div class="stat-icon">
                    <i class="bi bi-calendar-week-fill"></i>
                </div>
                <div class="stat-content">
                    <h3>@Model.TotalCourses</h3>
                    <p>Total Courses</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-card bg-warning">
                <div class="stat-icon">
                    <i class="bi bi-book-fill"></i>
                </div>
                <div class="stat-content">
                    <h3>@Model.TotalSubjects</h3>
                    <p>Total Subjects</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="stat-card bg-danger">
                <div class="stat-icon">
                    <i class="bi bi-award-fill"></i>
                </div>
                <div class="stat-content">
                    <h3>@Model.AverageGrade.ToString("F2")/20</h3>
                    <p>Average Grade</p>
                </div>
            </div>
        </div>
    </div>

  
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-bar-chart-fill"></i> Subject Performance</h5>
                </div>
                <div class="card-body">
                    <div id="subjectPerformanceChart"></div>
                </div>
            </div>
        </div>
    </div>


    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-graph-up"></i> Monthly Enrollments</h5>
                </div>
                <div class="card-body">
                    <div id="enrollmentChart"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-person-workspace"></i> Teacher Workload</h5>
                </div>
                <div class="card-body">
                    <div id="teacherWorkloadChart"></div>
                </div>
            </div>
        </div>
    </div>

  
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-table"></i> Classroom Statistics</h5>
                </div>
                <div class="card-body">
                    <div id="classroomGrid"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn3.devexpress.com/jslib/20.1.3/js/dx.all.js"></script>
    
    <script>
        $(document).ready(function() {
          
            $.get('@Url.Action("GetSubjectPerformance", "Dashboard")', function(data) {
                $("#subjectPerformanceChart").dxChart({
                    dataSource: data,
                    size: {
                        height: 200  
                    },
                    commonSeriesSettings: {
                        argumentField: "subjectName",
                        type: "bar"
                    },
                    series: [
                        { valueField: "averageScore", name: "Average Score" }
                    ],
                    legend: {
                        verticalAlignment: "bottom",
                        horizontalAlignment: "center"
                    },
                    title: {
                        text: "Average Scores by Subject",
                        font: { size: 14 }
                    },
                    tooltip: {
                        enabled: true,
                        customizeTooltip: function(arg) {
                            return {
                                text: arg.seriesName + ": " + arg.valueText + "/20"
                            };
                        }
                    },
                    argumentAxis: {
                        label: {
                            rotationAngle: -45,
                            overlappingBehavior: "rotate"
                        }
                    },
                    valueAxis: {
                        title: { text: "Score (out of 20)" },
                        max: 20
                    }
                });
            });

          
            $.get('@Url.Action("GetMonthlyEnrollments", "Dashboard")', function(data) {
                $("#enrollmentChart").dxChart({
                    dataSource: data,
                    size: {
                        height: 200 
                    },
                    commonSeriesSettings: {
                        argumentField: "month",
                        type: "line"
                    },
                    series: [
                        { valueField: "count", name: "Enrollments" }
                    ],
                    legend: {
                        verticalAlignment: "bottom",
                        horizontalAlignment: "center"
                    },
                    title: {
                        text: "Enrollment Trends (Last 12 Months)",
                        font: { size: 14 }
                    },
                    tooltip: {
                        enabled: true
                    },
                    argumentAxis: {
                        label: {
                            rotationAngle: -45
                        }
                    }
                });
            });

            
            $.get('@Url.Action("GetTeacherWorkload", "Dashboard")', function(data) {
                $("#teacherWorkloadChart").dxChart({
                    dataSource: data,
                    size: {
                        height: 200  // Set chart height in pixels
                    },
                    commonSeriesSettings: {
                        argumentField: "teacherName",
                        type: "bar"
                    },
                    series: [
                        { valueField: "courseCount", name: "Courses" },
                        { valueField: "studentCount", name: "Students" }
                    ],
                    legend: {
                        verticalAlignment: "bottom",
                        horizontalAlignment: "center"
                    },
                    title: {
                        text: "Teacher Workload Analysis",
                        font: { size: 14 }
                    },
                    tooltip: {
                        enabled: true
                    },
                    argumentAxis: {
                        label: {
                            rotationAngle: -45,
                            overlappingBehavior: "rotate"
                        }
                    }
                });
            });

         
            $.get('@Url.Action("GetClassroomStatistics", "Dashboard")', function(data) {
                $("#classroomGrid").dxDataGrid({
                    dataSource: data,
                    showBorders: true,
                    showRowLines: true,
                    showColumnLines: true,
                    rowAlternationEnabled: true,
                    columnAutoWidth: true,
                    columns: [
                        { dataField: "classroomName", caption: "Classroom", width: 200 },
                        { dataField: "studentCount", caption: "Students", width: 120, alignment: "center" },
                        { dataField: "courseCount", caption: "Courses", width: 120, alignment: "center" },
                        { 
                            dataField: "averageGrade", 
                            caption: "Average Grade", 
                            width: 150, 
                            alignment: "center",
                            customizeText: function(cellInfo) {
                                return cellInfo.value.toFixed(2) + "/20";
                            }
                        }
                    ],
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    
                    searchPanel: {
                        visible: true,
                        width: 100,
                        placeholder: "Search..."
                    },
                    
                   
                });
            });
        });
    </script>
}

<style>
    .dashboard-container {
        padding: 15px;
    }
    
    .row.mb-4 {
        margin-bottom: 1rem !important;
    }

    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 12px 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        color: white;
        margin-bottom: 12px;
        height: 70px; 
    }

    .stat-card.bg-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .stat-card.bg-success { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .stat-card.bg-info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .stat-card.bg-warning { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .stat-card.bg-secondary { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
    .stat-card.bg-dark { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
    .stat-card.bg-danger { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }

    .stat-icon {
        font-size: 28px;
        margin-right: 12px;
        opacity: 0.8;
        flex-shrink: 0;
    }

    .stat-content {
        flex: 1;
        min-width: 0;
    }

    .stat-content h3 {
        margin: 0;
        font-size: 20px;
        font-weight: bold;
        line-height: 1.2;
    }

    .stat-content p {
        margin: 2px 0 0 0;
        font-size: 11px;
        opacity: 0.9;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .card {
        border: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-radius: 8px;
        margin-bottom: 15px;
         max-width: 900px; 
        
              
    }

    .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px 8px 0 0 !important;
        padding: 10px 15px;
    }

    .card-header h5 {
        margin: 0;
        font-size: 16px;
    }

    .card-body {
        padding: 10px;
        min-height: 200px;  
    }
</style>
